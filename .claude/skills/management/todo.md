# /todo - 任务管理助手

## 描述
智能管理 docs/todo.md，自动拆分复杂任务、跟踪进度、识别依赖关系和阻塞问题。

## 适用场景
- 复杂功能拆分（Build adapter 细化为 7 个子任务）
- 阻塞问题标记（插件加载失败影响 dev 启动）
- 进度可视化（按模块/优先级分组）
- 任务依赖分析（识别前置条件）

## 工作流程
1. 解析 docs/todo.md（按 M0~M5 分组）
2. 识别任务状态（[x] 完成 / [ ] 待办 / [!] 阻塞）
3. 分析任务依赖关系
4. 智能拆分大任务为可执行步骤
5. 更新 TODO 并同步提交

## 输入示例

### 示例 1：拆分复杂任务
```
/todo 将 M1 Build adapter 拆分为可执行的详细步骤
```

**预期输出：**
```markdown
## M1：Build（静态产物）

### 核心任务拆分

- [ ] **扫描与路由生成**
  - [ ] 实现 CollectionScanner（扫描 collections）
  - [ ] 生成静态路由表（所有页面路径）
  - [ ] 处理动态路由（tag/category/archive）

- [ ] **预渲染 HTML**
  - [ ] 实现 HTMLRenderer（复用 dev 渲染逻辑）
  - [ ] 注入主题 shell（layout/sidebar/toc）
  - [ ] 处理资源路径（相对路径转换）

- [ ] **子路径部署支持**
  - [ ] 实现 site.base 配置解析
  - [ ] 路由前缀注入
  - [ ] 资源 URL 重写

- [ ] **构建产物输出**
  - [ ] 实现 dist/ 目录生成
  - [ ] 复制静态资源（images/fonts）
  - [ ] 生成 404.html

- [ ] **Preview 命令**
  - [ ] 实现本地静态服务器
  - [ ] 支持 SPA fallback（history mode）

- [ ] **Sitemap 生成**
  - [ ] 收集所有页面 URL
  - [ ] 生成 sitemap.xml
  - [ ] 支持 lastmod/changefreq

- [ ] **草稿策略**
  - [ ] draft: true 在 build 默认排除
  - [ ] --include-drafts 参数支持

### 依赖关系
- ✅ 依赖：M0 Core 渲染管线完成
- ⚠️ 阻塞：M2 主题系统（需要稳定的 theme shell）
- 🔄 并行：M1 可与 M3 插件系统并行开发

### 优先级建议
1. P0（核心）：扫描、路由、预渲染（阻塞后续）
2. P1（重要）：子路径部署、preview（发布必需）
3. P2（可选）：sitemap、草稿策略（可后补）
```

### 示例 2：标记阻塞问题
```
/todo 标记当前阻塞问题
```

**预期输出：**
```markdown
## ⚠️ 当前阻塞问题

### [!] 高优先级阻塞（影响 M1 完成）

1. **插件加载失败导致 build 中断** (#47)
   - 现象：某些插件 manifest 校验失败导致整体构建失败
   - 影响：M1 Build adapter 无法正常工作
   - 负责人：@developer
   - 截止日期：2025-12-25
   - 解决方案：添加插件错误处理与降级策略

2. **Windows 路径规范化问题** (#43)
   - 现象：路径分隔符不一致导致路由匹配失败
   - 影响：跨平台兼容性
   - 负责人：@developer
   - 截止日期：2025-12-24
   - 解决方案：统一使用 posix 路径格式

### [⏳] 等待依赖（非阻塞但需关注）

1. **主题 shell 接口未稳定**
   - 当前状态：M2 设计阶段
   - 影响：Build adapter 的主题注入逻辑可能需要重构
   - 建议：先使用临时 mock 实现，待 M2 完成后对齐
```

### 示例 3：查看进度
```
/todo 显示 M1 进度
```

**预期输出：**
```markdown
## M1 进度报告（Build 静态产物）

**完成度：** 3/7 (43%)
**预计完成时间：** 2025-12-30

### ✅ 已完成（3 项）
- [x] 扫描 → 索引 → 路由基础链路
- [x] Markdown 渲染复用（dev 逻辑）
- [x] 静态资源复制

### 🔄 进行中（2 项）
- [~] 预渲染 HTML 输出（60% 完成，预计 2 天）
- [~] site.base 子路径支持（设计阶段，预计 3 天）

### ⏳ 待开始（2 项）
- [ ] preview 命令
- [ ] sitemap.xml 生成

### 📊 速度分析
- 过去 7 天完成：2 个任务
- 平均速度：1 任务/3.5 天
- 预测完成日期：2025-12-30（假设速度不变）

### ⚠️ 风险
- 资源路径重写逻辑复杂，可能需要额外 2-3 天
- 主题 shell 接口变更可能导致返工
```

## 智能特性

### 1. 依赖检测
自动识别任务间的依赖关系：
- "Build 产物"依赖"Core 渲染管线完成"
- "插件示例"依赖"插件系统设计完成"

### 2. 风险提示
标注高复杂度任务：
- 增量更新（高复杂度，建议预留 buffer）
- 跨平台兼容性（需要充分测试）

### 3. 优先级建议
基于里程碑目标推荐下一步任务：
- P0：阻塞性任务（必须先完成）
- P1：核心功能（里程碑关键路径）
- P2：增强功能（可延后）

### 4. 工作量估算
基于历史速度预测完成时间（参考，非承诺）

## 任务状态标记

```markdown
- [ ] 待开始任务
- [~] 进行中任务（可选：标注进度百分比）
- [x] 已完成任务
- [!] 阻塞任务（需要优先解决）
- [?] 待讨论任务（需要决策）
```

## 相关文件
- docs/todo.md（主任务清单）
- docs/requirements.md（功能需求来源）
- docs/architecture.md（架构约束）

## 配合使用的 Skills
- `/roadmap` - 规划里程碑后，拆分为具体任务
- `/implement` - 任务明确后，开始实现
- `/milestone` - 查看里程碑级别的进度
