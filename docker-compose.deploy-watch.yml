services:
  hot-docs-sync:
    build:
      context: .
      dockerfile: Dockerfile.deploy-watch
      args:
        NODE_IMAGE: ${NODE_IMAGE:-node:22-bookworm-slim}
    container_name: hot-docs-sync
    environment:
      - TZ=Asia/Shanghai
    volumes:
      - ./content:/app/content
      - ./hot-docs.config.json:/app/hot-docs.config.json:ro
      - ./scripts:/app/scripts:ro
      - ~/.ssh:/root/.ssh:ro
    command:
      [
        "node",
        "scripts/deploy-watch.mjs",
        "--host",
        "${HOT_DOCS_DEPLOY_HOST}",
        "--user",
        "${HOT_DOCS_DEPLOY_USER}",
        "--dest",
        "${HOT_DOCS_DEPLOY_DEST}",
        "--identity",
        "${HOT_DOCS_DEPLOY_IDENTITY:-/root/.ssh/id_ed25519}",
        "--debounce",
        "1500",
        "--poll",
        "--poll-interval",
        "1000"
      ]
    restart: unless-stopped
